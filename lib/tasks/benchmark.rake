require 'benchmark'
namespace :benchmark do


  desc 'Benchmark court search'
  task court_search: :environment do
    #captured random postcodes
    coords = [[51.53972265151791, -2.416840222841319], [53.42576784080958, -2.316724735208613], [51.42909837532802, -0.4980951729677009], [51.47824146577774, -3.17969043838473], [52.75172261446005, 0.3940049654134504], [52.06393067136082, -1.340885747340279], [54.77409361325621, -1.567893517493979], [51.49649688151636, 0.09013840010264906], [51.06857517433321, -0.3225607762880501], [54.68578352802808, -1.214004962265196], [52.13502988254417, -0.467879876037845], [51.46381570957838, -0.3034733454943055], [51.66304405994894, -3.801911117708887], [53.38519853604043, -1.464969589947553], [52.50973201931085, -2.087874368312748], [51.51141017229456, -0.3233370517174868], [51.26331532818237, -1.083178243011578], [51.23853615167531, -0.1820249534739728], [50.94055229504551, -2.635009815893335], [51.38422917821774, 0.5268823590306786], [53.96132208881506, -2.01319316356382], [51.37333817528926, -0.0921486285213919], [52.24250333714839, 0.719564129610343], [52.2041999650616, 0.1219903835057751], [53.39305793432016, -3.013580921793925], [52.20371345718508, 0.1320660105016624], [52.48166135876607, -1.895528937739964], [53.3257767862225, -2.694466472478073], [51.45272620941393, -2.1111813972691], [51.61073867700753, -0.06607841813261416], [53.80220600323893, -1.755860857190757], [54.11652236284811, -3.227577428813617], [53.59303601338309, -2.305435402514594], [52.41271402794617, -1.781356389068482], [53.42915846611348, -1.358343657924194], [50.76754729395986, 0.2777548241457489], [51.40092907985858, -1.317982425290335], [52.0568577451125, 1.148893649953781], [51.3608031593535, -2.90509473272019], [51.40588218897574, -0.3044248138131593], [52.80592940209844, -2.113645354977041], [52.70461857880404, -2.731136155006492], [52.2485814487563, 0.7110132472960647], [54.62049941496149, -1.569676518561873], [53.23620378670869, -1.423334183867341], [53.74359662105593, -1.599255970794555], [51.81078059044155, -0.8081708594220313], [53.23458990462412, -0.5405761144906363], [52.48782709919727, -0.6990430222402915], [52.6345502860252, 1.301821131986095], [50.70120894231799, -1.291858099502311], [53.22460215586209, -0.5420241935584984], [51.45239654937663, -2.590567201633737], [52.52295610950066, -1.462427988680201], [51.8779686832708, -0.4139453239078564], [51.85616957442477, -4.307630470699952], [51.2489077015636, -0.7632169835725644], [53.47867447582347, -2.234925090404637], [53.33657607070594, -3.416416294259929], [51.86645377015608, -2.248600403071705], [51.49076156207002, -0.219473235655058], [52.98306022919011, -0.02498167406615975], [52.4540213035203, -2.14296073675072], [51.48455708705789, -3.180256705503525], [53.17700279051488, -3.137170826790298], [51.51414379268482, -0.1137411619116455], [51.48836266228357, -0.1098647307167622], [51.5161650341844, -0.1108182958827761], [53.32903870553805, -2.696186141861737], [53.42631111886911, -2.325276670211602], [54.33348722439156, -1.435884709510595], [51.59069226170553, -0.01478441986714872], [52.05365482001364, 1.143212022769182], [51.12790830272645, 1.313686348227225], [51.23896220567872, -0.5771973556434955], [54.52373273532974, -1.558318638887264], [51.37971831070093, -0.1046008891287342], [51.81566603254524, -0.8120315084920131], [53.56878179947732, -2.883115806279844], [53.79093159521678, -2.240887998368411], [51.41700910694852, -0.7481163899381694], [50.72790048165427, -1.863580188952401], [53.69046649462149, -2.699835110072728], [52.94854105243607, -1.146650301665879], [51.73721379373496, 0.4759913706397135], [53.38555692960198, -1.468738846717915], [51.45914878957377, -0.2092027379575963], [54.95902830652008, -1.600237509957054], [51.75161963005263, -0.3355215063225961], [54.28146577635686, -0.4079113353054239], [53.5679088429915, -0.08169236509812784], [51.28008476246941, 0.1772765235584056], [51.89909930377065, -2.083433498017279], [51.27870366890121, 1.085774186497513], [51.81078059044155, -0.8081708594220313], [53.40915222004872, -2.986268246736795], [54.0465230885758, -2.797380876082494], [53.14043024078838, -4.264335617925146], [53.40417026841992, -2.989778078189362], [54.75568509276319, -1.336150811832721], [53.30228580449802, -2.374240917501762], [53.48012232694553, -2.252201156281677], [53.39137808560015, -3.016623667340638], [54.99302547863772, -1.439085846455114], [53.56484433531853, -0.0822382539750061], [51.76830735460961, 0.09674436770638706], [55.1667895351529, -1.690495744712281], [52.5890904724748, -1.985638941377113], [51.59382452248521, -0.3398088482391178], [50.7213204336005, -3.525075523262833], [52.30630285878298, -1.936948437685561], [51.25032001515684, -0.7692978000956944], [52.63005352315573, -1.12710509961754], [51.28197798499508, 1.094957757289137], [54.89356055201059, -2.931247835015713], [51.01429706069357, -3.109670307978743], [53.48090332575237, -2.252672912883409], [53.45494532549212, -2.736480561068445], [50.82323518215221, -0.1342961201254463], [51.53916042899769, 0.0002911951288142492], [51.23876768986134, -0.578951050528603], [51.54678937719003, -0.1055405166751802], [52.94854105243607, -1.146650301665879], [51.27080864720933, 0.5186173837442408], [53.32020031756628, -3.488507014771732], [53.39061894714674, -2.598820657815331], [53.18708370330262, -3.414581787248978], [54.89356055201059, -2.931247835015713], [51.81078059044155, -0.8081708594220313], [51.66159803464073, -3.799453543457913], [54.57352406843133, -1.234574045201777], [53.17700279051488, -3.137170826790298], [51.15141359092068, -0.9713862513164545], [50.79578026694382, -1.091162076432136], [52.25175419400193, -3.369819335064596], [53.74983110481826, -2.486135634323614], [51.51414379268482, -0.1137411619116455], [50.26554821168633, -5.056642702435703], [52.63224625245266, -1.134345846011187], [53.18859430703404, -2.887015802240816], [52.48373672908646, -1.894051498186328], [54.11652236284811, -3.227577428813617], [51.44751986080112, -0.4058790072113536], [51.48211425037113, -3.166483685225312], [52.2411156628818, -0.8962094747280264], [51.49263660915904, 0.06182698230495871], [50.83295305129925, -0.1498856810782945], [51.51549205198573, -0.1019966744505173], [52.6345502860252, 1.301821131986095], [51.59181097916993, -3.785143661768767], [51.45479287044306, -2.595002117824608], [52.50222172482291, -2.011358525414919], [51.47377699660613, -0.09654322039322955], [54.04973681300905, -2.8060568865552], [52.70495038711648, -2.729809701069753], [53.22446609322916, -0.5411899596916334], [51.45272620941393, -2.1111813972691], [53.25679285511808, -1.913081160818163], [52.47835177990914, 1.755875971529079], [51.37239682826455, -0.0939837396491515], [51.07286445411427, -1.810187975119545], [52.39729372129539, -0.725649166980182], [53.09766648683986, -2.438724747553797], [53.14043024078838, -4.264335617925146], [53.14043024078838, -4.264335617925146], [54.86138875685004, -1.573021377960122], [52.67774116189877, -2.451497648536399], [51.45643113172549, -0.971052233175822], [52.48166135876607, -1.895528937739964], [53.26351813056102, -2.124977094761477], [53.79274521811999, -1.748872250515465], [54.89356055201059, -2.931247835015713], [51.26331532818237, -1.083178243011578], [53.80102832707026, -1.552886639717577], [51.75201800656414, -1.261122979073233], [51.53916042899769, 0.0002911951288142492], [51.58101790810205, 0.01728429562993307], [50.85333915667842, -1.183138473433986], [53.7491281247251, -2.359323760375266], [53.40417026841992, -2.989778078189362], [52.94854105243607, -1.146650301665879], [51.5249518927318, -0.7142967026308185], [50.82301624689145, -0.1352277390938858], [53.76239557329587, -2.698983152610142], [53.74410034651311, -0.3317151943219205], [51.06254955783433, -1.319368478028908], [52.68471851651409, -2.035652408908228], [52.20690087625812, 0.1367997447678781], [51.40880180698709, 0.01341926154139467], [53.51904208791115, -1.134040861390808], [51.27141804895543, 0.523310427133107], [53.40417026841992, -2.989778078189362], [50.87298246105111, 0.009513462912203676], [51.52707452695388, -0.02359355377055548], [52.4830895454478, -1.89415612507655], [51.51829585470558, -0.1298714803233022], [52.90406052318392, -0.6501677083476987], [51.66653054944502, -3.192933699322247], [51.58187096365993, -0.2456474632392328], [52.48335097362067, -1.894965386736062], [49.91461333841871, -6.317148967041708], [53.18763788588225, -2.893506207575379], [52.92462144903158, -1.479914339054746], [50.46952752182586, -4.708865488171956], [52.92245156637324, -1.473009079837809], [53.8118075405438, -3.053836873269933], [51.45239654937663, -2.590567201633737], [51.59817233603496, -0.07295106686552935], [51.58771250105647, 0.08141674810366231], [50.2683000373657, -5.044005182045471], [50.72216421956025, -1.960834573921607], [54.95902830652008, -1.600237509957054], [51.74777749758063, -3.381026178550222], [54.85756288332496, -1.830287546463585], [51.51761090177792, -0.1388214502596158], [52.63005352315573, -1.12710509961754], [50.82301624689145, -0.1352277390938858], [51.5695013784008, -3.217387941493205], [51.44458547264836, 0.2119178763725342], [51.47921655375414, -0.3403301314615689], [50.71634839652015, -2.440042279952738], [52.05779497745515, 1.151177327990838], [52.40583226251002, -1.50762739318735], [53.84052313074718, -0.4286689967539282], [53.40756243096482, -2.161561773035751], [53.23696083594745, -1.423743531269977], [51.51414379268482, -0.1137411619116455], [52.54470720022525, -1.373657278120058], [51.49818277415027, -0.09653509248865078], [51.08134299066393, -4.065658583070042], [52.06393067136082, -1.340885747340279], [51.38422917821774, 0.5268823590306786], [51.54291861713723, 0.0108540511425618], [52.39894660612846, -0.7271889411232679], [54.77409361325621, -1.567893517493979], [54.68578352802808, -1.214004962265196], [51.59837769352312, -3.34079718441666], [51.59181097916993, -3.785143661768767], [51.58244105071002, -2.986519756373077], [50.46952752182586, -4.708865488171956], [53.45494532549212, -2.736480561068445], [52.13502988254417, -0.467879876037845], [52.38418012108554, -2.240893389520689], [52.05708079199627, -2.710989875732168], [53.01333160142167, -2.230255894829876], [51.58265075814084, 0.1876402353403927], [51.571771554916, 0.4582284204642961], [53.64431080133155, -1.783909819372335], [50.91370617668372, -1.402976724607234], [53.78707325015339, -2.242125636241213], [53.72018093472855, -1.863336411560632], [53.57870600163137, -2.43167028202129], [51.27080864720933, 0.5186173837442408], [51.20985688173164, -1.482330671451449], [52.77208214875495, -1.202058118559686], [54.3346957498346, -2.747967497960563], [50.36558388790405, -4.105463543393149], [52.80542928949429, -2.119429229776115], [50.26554821168633, -5.056642702435703], [53.48736329261695, -2.227196681448202], [51.75023185108618, -1.267366565288957], [53.18600545658223, -2.891826082532298], [51.85568308495346, -4.319557388260368], [51.4551827626422, 0.1479002374192346], [51.8217597592616, -3.023195863707993], [51.52460541822825, -0.09779757588799673], [52.47835177990914, 1.755875971529079], [51.47367229112791, -0.01910593385814939], [53.0484606394315, -2.989528216582408], [50.83325191998014, -0.7795162547510595], [52.04104771578385, -0.7662915931093074], [50.74795220551508, -1.81626549328006], [53.17700279051488, -3.137170826790298], [54.05084985269013, -2.803588730319752], [51.51414379268482, -0.1137411619116455], [51.3608031593535, -2.90509473272019], [53.76349040372202, -2.702353840518505], [51.51589484564764, -0.1096764407820697], [51.89919250164728, -1.157803686958573], [50.72413087797089, -3.517147745954368], [52.4540213035203, -2.14296073675072], [51.08134299066393, -4.065658583070042], [53.32020886254219, -3.823278029784428], [52.56975371489718, -0.2415301617608181], [51.51589484564764, -0.1096764407820697], [51.79609030732506, -0.0765904167707224], [52.28883199448166, -1.533936129807476], [51.45334301433294, -0.9757414720839976], [53.57820433663913, -2.433688977914306], [51.46281920524684, 0.1325520326102995], [51.48211425037113, -3.166483685225312], [53.51946398791008, -1.130246544058874], [51.38081360237712, -2.354283800295112], [52.61317408435931, 1.72493363842554], [52.23730267649494, -0.8999651365094131], [51.24529207246317, -0.5823175221210912], [51.40762792051944, 0.01108142087285594], [54.96962552584358, -1.62115770629835], [53.18859430703404, -2.887015802240816], [50.91431379008816, -1.403978910994105], [52.23730267649494, -0.8999651365094131], [53.54373571774141, -2.116869021784123], [53.25499098226683, -4.3116580497484], [53.02207340262607, -2.175754105614079], [51.54372910356008, 0.7097294815944704], [55.76986356796875, -2.001886906844226], [51.24529207246317, -0.5823175221210912], [53.51292317711295, -1.125720658749076], [51.65129889000839, -3.021274552120115], [53.54174017665157, -2.116999322819424], [50.36919435296687, -4.141694399328081], [50.369287345007, -4.139575100611581], [52.98306022919011, -0.02498167406615975], [52.58616944985786, -2.130417376852474], [53.48012232694553, -2.252201156281677], [51.79634217336982, -0.07714528875522358], [53.99020390630893, -1.540538389428427], [52.27755842625879, -0.873713796762021], [50.82874042970354, -0.1615679636912644], [51.50742637401229, -0.5981027616760134], [51.581867117497, 0.1857399595076986], [53.48557639318307, -2.102120972524918], [51.12991441570657, 0.2602083383632516], [54.52400708535173, -1.54984906884814], [51.54948434653862, -0.2477012889161268], [53.14859201910086, 0.344840973489315], [50.79595136088691, -1.09003782894078], [54.11652236284811, -3.227577428813617], [53.42915846611348, -1.358343657924194], [52.05779497745515, 1.151177327990838], [51.60043679042746, -0.1956067306192429], [51.08134299066393, -4.065658583070042], [52.24080390599972, -0.8936396023376622], [52.23730267649494, -0.8999651365094131], [53.14043024078838, -4.264335617925146], [52.75172261446005, 0.3940049654134504], [50.76754729395986, 0.2777548241457489], [54.96772319378463, -1.615786659775222], [51.51414379268482, -0.1137411619116455], [53.74989980458098, -2.482481759013183], [54.89751772005305, -2.93553374174145], [51.51414379268482, -0.1137411619116455], [51.38081360237712, -2.354283800295112], [53.22446609322916, -0.5411899596916334], [53.57820433663913, -2.433688977914306], [51.73590041851336, 0.4725585580169394], [53.65403180411484, -2.634609730435104], [52.63005352315573, -1.12710509961754], [53.59303601338309, -2.305435402514594], [50.93963279304383, -2.633773291825025], [51.45602509008713, -0.9668010829893584], [54.99302547863772, -1.439085846455114], [50.85939344146038, 0.5666928879804102], [51.48428614838842, -0.3043556601994781], [52.47622502257492, -1.898515795860216], [51.85568308495346, -4.319557388260368], [52.23730267649494, -0.8999651365094131], [53.68398320075974, -1.502269035982297], [51.88112876672225, -0.4189192540150118], [52.75510990723888, 0.3941314678401524], [53.02207340262607, -2.175754105614079], [53.09766648683986, -2.438724747553797], [51.50742637401229, -0.5981027616760134], [51.45915766146755, -2.592468070891811], [51.58838179798339, -3.004937356285819], [53.48557639318307, -2.102120972524918], [50.7213204336005, -3.525075523262833], [52.24250333714839, 0.719564129610343], [52.63423459985376, 1.301531261455493], [52.52295610950066, -1.462427988680201], [51.86340415972698, -2.249396805579488], [51.51414379268482, -0.1137411619116455], [51.7481711963701, -1.257071912530987], [53.99020390630893, -1.540538389428427], [51.11736856247219, -0.1810695712763016], [54.99761841326092, -1.459514913512023], [51.59181097916993, -3.785143661768767], [52.24250333714839, 0.719564129610343], [53.25679285511808, -1.913081160818163], [52.19692750164697, -2.224326565333416], [50.74795220551508, -1.81626549328006], [53.78772809430154, -2.247153367903415], [51.07895347480603, 1.169228560952259], [53.71927846526278, -1.860157110261616], [51.86539864036159, -2.250104932752648], [52.94728391663387, -1.149353924154681], [52.57006689978415, -0.2402190993317043], [51.51843668350799, -0.1145151069383994]]

    puts 'Using Postgis'
    puts Benchmark.measure {
      coords.each do |latlng|
        Court.gisnear(latlng, 300).count
      end
    }

    puts 'Without Postgis'
    puts Benchmark.measure {
      coords.each do |latlng|
        Court.near(latlng, 300).count
      end
    }


  end

end